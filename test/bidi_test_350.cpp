// Warning! This file is autogenerated.
#include <boost/text/bidirectional.hpp>

#include "bidi_tests.hpp"

#include <gtest/gtest.h>

#include <algorithm>


std::vector<int> expected_levels;

TEST(bidi, bidi_350_000)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO ES R FSI; 5 ('auto') (line 350001)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x05BE, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES R FSI; 5 ('RTL') (line 350001)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x05BE, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES R PDI; 5 ('auto') (line 350002)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x05BE, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES R PDI; 5 ('RTL') (line 350002)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x05BE, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES AL B; 5 ('auto') (line 350003)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0608, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES AL B; 5 ('RTL') (line 350003)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0608, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES AL S; 5 ('auto') (line 350004)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0608, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES AL S; 5 ('RTL') (line 350004)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0608, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES AL WS; 5 ('auto') (line 350005)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0608, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES AL WS; 5 ('RTL') (line 350005)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0608, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES AL LRI; 5 ('auto') (line 350006)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0608, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES AL LRI; 5 ('RTL') (line 350006)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0608, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES AL RLI; 5 ('auto') (line 350007)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0608, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES AL RLI; 5 ('RTL') (line 350007)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0608, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES AL FSI; 5 ('auto') (line 350008)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0608, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES AL FSI; 5 ('RTL') (line 350008)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0608, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES AL PDI; 5 ('auto') (line 350009)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0608, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES AL PDI; 5 ('RTL') (line 350009)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0608, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES EN B; 4 ('RTL') (line 350010)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0030, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES EN S; 4 ('RTL') (line 350011)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0030, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES EN WS; 4 ('RTL') (line 350012)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0030, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES EN LRI; 4 ('RTL') (line 350013)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0030, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES EN RLI; 4 ('RTL') (line 350014)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0030, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES EN FSI; 4 ('RTL') (line 350015)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0030, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES EN PDI; 4 ('RTL') (line 350016)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0030, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES ES B; 4 ('RTL') (line 350017)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x002B, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES ES S; 4 ('RTL') (line 350018)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x002B, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES ES WS; 4 ('RTL') (line 350019)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x002B, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES ES LRI; 4 ('RTL') (line 350020)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x002B, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES ES RLI; 4 ('RTL') (line 350021)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x002B, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES ES FSI; 4 ('RTL') (line 350022)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x002B, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES ES PDI; 4 ('RTL') (line 350023)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x002B, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES ET B; 4 ('RTL') (line 350024)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0023, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES ET S; 4 ('RTL') (line 350025)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0023, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_001)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO ES ET WS; 4 ('RTL') (line 350026)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0023, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES ET LRI; 4 ('RTL') (line 350027)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0023, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES ET RLI; 4 ('RTL') (line 350028)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0023, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES ET FSI; 4 ('RTL') (line 350029)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0023, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES ET PDI; 4 ('RTL') (line 350030)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0023, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES AN B; 4 ('RTL') (line 350031)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0660, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES AN S; 4 ('RTL') (line 350032)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0660, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES AN WS; 4 ('RTL') (line 350033)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0660, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES AN LRI; 4 ('RTL') (line 350034)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0660, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES AN RLI; 4 ('RTL') (line 350035)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0660, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES AN FSI; 4 ('RTL') (line 350036)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0660, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES AN PDI; 4 ('RTL') (line 350037)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0660, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES CS B; 4 ('RTL') (line 350038)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x002C, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES CS S; 4 ('RTL') (line 350039)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x002C, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES CS WS; 4 ('RTL') (line 350040)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x002C, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES CS LRI; 4 ('RTL') (line 350041)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x002C, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES CS RLI; 4 ('RTL') (line 350042)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x002C, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES CS FSI; 4 ('RTL') (line 350043)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x002C, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES CS PDI; 4 ('RTL') (line 350044)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x002C, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES NSM B; 4 ('RTL') (line 350045)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0300, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES NSM S; 4 ('RTL') (line 350046)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0300, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES NSM WS; 4 ('RTL') (line 350047)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0300, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES NSM LRI; 4 ('RTL') (line 350048)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0300, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES NSM RLI; 4 ('RTL') (line 350049)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0300, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES NSM FSI; 4 ('RTL') (line 350050)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0300, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_002)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO ES NSM PDI; 4 ('RTL') (line 350051)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0300, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES ON B; 4 ('RTL') (line 350052)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0021, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES ON S; 4 ('RTL') (line 350053)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0021, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES ON WS; 4 ('RTL') (line 350054)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0021, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES ON LRI; 4 ('RTL') (line 350055)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0021, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES ON RLI; 4 ('RTL') (line 350056)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0021, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES ON FSI; 4 ('RTL') (line 350057)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0021, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ES ON PDI; 4 ('RTL') (line 350058)
        std::vector<uint32_t> const cps = { 0x202E, 0x002B, 0x0021, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET L B; 4 ('RTL') (line 350059)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0041, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET L S; 4 ('RTL') (line 350060)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0041, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET L WS; 4 ('RTL') (line 350061)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0041, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET L LRI; 4 ('RTL') (line 350062)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0041, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET L RLI; 4 ('RTL') (line 350063)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0041, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET L FSI; 4 ('RTL') (line 350064)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0041, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET L PDI; 4 ('RTL') (line 350065)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0041, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET R B; 5 ('auto') (line 350066)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x05BE, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET R B; 5 ('RTL') (line 350066)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x05BE, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET R S; 5 ('auto') (line 350067)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x05BE, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET R S; 5 ('RTL') (line 350067)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x05BE, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET R WS; 5 ('auto') (line 350068)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x05BE, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET R WS; 5 ('RTL') (line 350068)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x05BE, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET R LRI; 5 ('auto') (line 350069)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x05BE, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET R LRI; 5 ('RTL') (line 350069)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x05BE, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET R RLI; 5 ('auto') (line 350070)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x05BE, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET R RLI; 5 ('RTL') (line 350070)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x05BE, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET R FSI; 5 ('auto') (line 350071)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x05BE, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET R FSI; 5 ('RTL') (line 350071)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x05BE, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET R PDI; 5 ('auto') (line 350072)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x05BE, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET R PDI; 5 ('RTL') (line 350072)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x05BE, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET AL B; 5 ('auto') (line 350073)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0608, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET AL B; 5 ('RTL') (line 350073)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0608, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET AL S; 5 ('auto') (line 350074)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0608, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET AL S; 5 ('RTL') (line 350074)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0608, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET AL WS; 5 ('auto') (line 350075)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0608, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET AL WS; 5 ('RTL') (line 350075)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0608, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_003)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO ET AL LRI; 5 ('auto') (line 350076)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0608, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET AL LRI; 5 ('RTL') (line 350076)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0608, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET AL RLI; 5 ('auto') (line 350077)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0608, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET AL RLI; 5 ('RTL') (line 350077)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0608, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET AL FSI; 5 ('auto') (line 350078)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0608, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET AL FSI; 5 ('RTL') (line 350078)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0608, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET AL PDI; 5 ('auto') (line 350079)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0608, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET AL PDI; 5 ('RTL') (line 350079)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0608, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET EN B; 4 ('RTL') (line 350080)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0030, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET EN S; 4 ('RTL') (line 350081)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0030, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET EN WS; 4 ('RTL') (line 350082)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0030, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET EN LRI; 4 ('RTL') (line 350083)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0030, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET EN RLI; 4 ('RTL') (line 350084)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0030, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET EN FSI; 4 ('RTL') (line 350085)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0030, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET EN PDI; 4 ('RTL') (line 350086)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0030, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET ES B; 4 ('RTL') (line 350087)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x002B, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET ES S; 4 ('RTL') (line 350088)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x002B, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET ES WS; 4 ('RTL') (line 350089)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x002B, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET ES LRI; 4 ('RTL') (line 350090)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x002B, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET ES RLI; 4 ('RTL') (line 350091)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x002B, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET ES FSI; 4 ('RTL') (line 350092)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x002B, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET ES PDI; 4 ('RTL') (line 350093)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x002B, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET ET B; 4 ('RTL') (line 350094)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0023, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET ET S; 4 ('RTL') (line 350095)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0023, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET ET WS; 4 ('RTL') (line 350096)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0023, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET ET LRI; 4 ('RTL') (line 350097)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0023, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET ET RLI; 4 ('RTL') (line 350098)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0023, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET ET FSI; 4 ('RTL') (line 350099)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0023, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET ET PDI; 4 ('RTL') (line 350100)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0023, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_004)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO ET AN B; 4 ('RTL') (line 350101)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0660, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET AN S; 4 ('RTL') (line 350102)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0660, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET AN WS; 4 ('RTL') (line 350103)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0660, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET AN LRI; 4 ('RTL') (line 350104)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0660, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET AN RLI; 4 ('RTL') (line 350105)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0660, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET AN FSI; 4 ('RTL') (line 350106)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0660, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET AN PDI; 4 ('RTL') (line 350107)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0660, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET CS B; 4 ('RTL') (line 350108)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x002C, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET CS S; 4 ('RTL') (line 350109)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x002C, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET CS WS; 4 ('RTL') (line 350110)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x002C, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET CS LRI; 4 ('RTL') (line 350111)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x002C, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET CS RLI; 4 ('RTL') (line 350112)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x002C, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET CS FSI; 4 ('RTL') (line 350113)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x002C, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET CS PDI; 4 ('RTL') (line 350114)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x002C, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET NSM B; 4 ('RTL') (line 350115)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0300, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET NSM S; 4 ('RTL') (line 350116)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0300, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET NSM WS; 4 ('RTL') (line 350117)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0300, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET NSM LRI; 4 ('RTL') (line 350118)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0300, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET NSM RLI; 4 ('RTL') (line 350119)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0300, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET NSM FSI; 4 ('RTL') (line 350120)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0300, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET NSM PDI; 4 ('RTL') (line 350121)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0300, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET ON B; 4 ('RTL') (line 350122)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0021, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET ON S; 4 ('RTL') (line 350123)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0021, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET ON WS; 4 ('RTL') (line 350124)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0021, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET ON LRI; 4 ('RTL') (line 350125)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0021, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_005)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO ET ON RLI; 4 ('RTL') (line 350126)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0021, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET ON FSI; 4 ('RTL') (line 350127)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0021, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ET ON PDI; 4 ('RTL') (line 350128)
        std::vector<uint32_t> const cps = { 0x202E, 0x0023, 0x0021, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN L B; 4 ('RTL') (line 350129)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0041, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN L S; 4 ('RTL') (line 350130)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0041, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN L WS; 4 ('RTL') (line 350131)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0041, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN L LRI; 4 ('RTL') (line 350132)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0041, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN L RLI; 4 ('RTL') (line 350133)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0041, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN L FSI; 4 ('RTL') (line 350134)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0041, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN L PDI; 4 ('RTL') (line 350135)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0041, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN R B; 5 ('auto') (line 350136)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x05BE, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN R B; 5 ('RTL') (line 350136)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x05BE, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN R S; 5 ('auto') (line 350137)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x05BE, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN R S; 5 ('RTL') (line 350137)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x05BE, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN R WS; 5 ('auto') (line 350138)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x05BE, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN R WS; 5 ('RTL') (line 350138)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x05BE, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN R LRI; 5 ('auto') (line 350139)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x05BE, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN R LRI; 5 ('RTL') (line 350139)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x05BE, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN R RLI; 5 ('auto') (line 350140)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x05BE, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN R RLI; 5 ('RTL') (line 350140)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x05BE, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN R FSI; 5 ('auto') (line 350141)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x05BE, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN R FSI; 5 ('RTL') (line 350141)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x05BE, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN R PDI; 5 ('auto') (line 350142)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x05BE, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN R PDI; 5 ('RTL') (line 350142)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x05BE, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN AL B; 5 ('auto') (line 350143)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0608, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN AL B; 5 ('RTL') (line 350143)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0608, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN AL S; 5 ('auto') (line 350144)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0608, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN AL S; 5 ('RTL') (line 350144)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0608, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN AL WS; 5 ('auto') (line 350145)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0608, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN AL WS; 5 ('RTL') (line 350145)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0608, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN AL LRI; 5 ('auto') (line 350146)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0608, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN AL LRI; 5 ('RTL') (line 350146)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0608, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN AL RLI; 5 ('auto') (line 350147)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0608, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN AL RLI; 5 ('RTL') (line 350147)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0608, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN AL FSI; 5 ('auto') (line 350148)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0608, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN AL FSI; 5 ('RTL') (line 350148)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0608, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN AL PDI; 5 ('auto') (line 350149)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0608, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN AL PDI; 5 ('RTL') (line 350149)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0608, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN EN B; 4 ('RTL') (line 350150)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0030, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_006)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO AN EN S; 4 ('RTL') (line 350151)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0030, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN EN WS; 4 ('RTL') (line 350152)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0030, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN EN LRI; 4 ('RTL') (line 350153)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0030, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN EN RLI; 4 ('RTL') (line 350154)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0030, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN EN FSI; 4 ('RTL') (line 350155)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0030, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN EN PDI; 4 ('RTL') (line 350156)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0030, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN ES B; 4 ('RTL') (line 350157)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x002B, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN ES S; 4 ('RTL') (line 350158)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x002B, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN ES WS; 4 ('RTL') (line 350159)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x002B, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN ES LRI; 4 ('RTL') (line 350160)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x002B, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN ES RLI; 4 ('RTL') (line 350161)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x002B, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN ES FSI; 4 ('RTL') (line 350162)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x002B, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN ES PDI; 4 ('RTL') (line 350163)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x002B, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN ET B; 4 ('RTL') (line 350164)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0023, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN ET S; 4 ('RTL') (line 350165)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0023, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN ET WS; 4 ('RTL') (line 350166)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0023, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN ET LRI; 4 ('RTL') (line 350167)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0023, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN ET RLI; 4 ('RTL') (line 350168)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0023, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN ET FSI; 4 ('RTL') (line 350169)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0023, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN ET PDI; 4 ('RTL') (line 350170)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0023, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN AN B; 4 ('RTL') (line 350171)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0660, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN AN S; 4 ('RTL') (line 350172)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0660, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN AN WS; 4 ('RTL') (line 350173)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0660, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN AN LRI; 4 ('RTL') (line 350174)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0660, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN AN RLI; 4 ('RTL') (line 350175)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0660, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_007)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO AN AN FSI; 4 ('RTL') (line 350176)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0660, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN AN PDI; 4 ('RTL') (line 350177)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0660, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN CS B; 4 ('RTL') (line 350178)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x002C, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN CS S; 4 ('RTL') (line 350179)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x002C, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN CS WS; 4 ('RTL') (line 350180)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x002C, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN CS LRI; 4 ('RTL') (line 350181)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x002C, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN CS RLI; 4 ('RTL') (line 350182)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x002C, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN CS FSI; 4 ('RTL') (line 350183)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x002C, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN CS PDI; 4 ('RTL') (line 350184)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x002C, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN NSM B; 4 ('RTL') (line 350185)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0300, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN NSM S; 4 ('RTL') (line 350186)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0300, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN NSM WS; 4 ('RTL') (line 350187)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0300, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN NSM LRI; 4 ('RTL') (line 350188)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0300, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN NSM RLI; 4 ('RTL') (line 350189)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0300, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN NSM FSI; 4 ('RTL') (line 350190)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0300, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN NSM PDI; 4 ('RTL') (line 350191)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0300, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN ON B; 4 ('RTL') (line 350192)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0021, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN ON S; 4 ('RTL') (line 350193)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0021, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN ON WS; 4 ('RTL') (line 350194)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0021, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN ON LRI; 4 ('RTL') (line 350195)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0021, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN ON RLI; 4 ('RTL') (line 350196)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0021, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN ON FSI; 4 ('RTL') (line 350197)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0021, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO AN ON PDI; 4 ('RTL') (line 350198)
        std::vector<uint32_t> const cps = { 0x202E, 0x0660, 0x0021, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS L B; 4 ('RTL') (line 350199)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0041, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS L S; 4 ('RTL') (line 350200)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0041, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_008)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO CS L WS; 4 ('RTL') (line 350201)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0041, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS L LRI; 4 ('RTL') (line 350202)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0041, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS L RLI; 4 ('RTL') (line 350203)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0041, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS L FSI; 4 ('RTL') (line 350204)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0041, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS L PDI; 4 ('RTL') (line 350205)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0041, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS R B; 5 ('auto') (line 350206)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x05BE, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS R B; 5 ('RTL') (line 350206)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x05BE, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS R S; 5 ('auto') (line 350207)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x05BE, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS R S; 5 ('RTL') (line 350207)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x05BE, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS R WS; 5 ('auto') (line 350208)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x05BE, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS R WS; 5 ('RTL') (line 350208)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x05BE, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS R LRI; 5 ('auto') (line 350209)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x05BE, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS R LRI; 5 ('RTL') (line 350209)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x05BE, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS R RLI; 5 ('auto') (line 350210)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x05BE, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS R RLI; 5 ('RTL') (line 350210)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x05BE, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS R FSI; 5 ('auto') (line 350211)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x05BE, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS R FSI; 5 ('RTL') (line 350211)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x05BE, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS R PDI; 5 ('auto') (line 350212)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x05BE, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS R PDI; 5 ('RTL') (line 350212)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x05BE, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS AL B; 5 ('auto') (line 350213)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0608, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS AL B; 5 ('RTL') (line 350213)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0608, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS AL S; 5 ('auto') (line 350214)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0608, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS AL S; 5 ('RTL') (line 350214)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0608, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS AL WS; 5 ('auto') (line 350215)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0608, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS AL WS; 5 ('RTL') (line 350215)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0608, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS AL LRI; 5 ('auto') (line 350216)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0608, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS AL LRI; 5 ('RTL') (line 350216)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0608, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS AL RLI; 5 ('auto') (line 350217)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0608, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS AL RLI; 5 ('RTL') (line 350217)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0608, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS AL FSI; 5 ('auto') (line 350218)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0608, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS AL FSI; 5 ('RTL') (line 350218)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0608, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS AL PDI; 5 ('auto') (line 350219)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0608, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS AL PDI; 5 ('RTL') (line 350219)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0608, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS EN B; 4 ('RTL') (line 350220)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0030, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS EN S; 4 ('RTL') (line 350221)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0030, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS EN WS; 4 ('RTL') (line 350222)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0030, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS EN LRI; 4 ('RTL') (line 350223)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0030, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS EN RLI; 4 ('RTL') (line 350224)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0030, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS EN FSI; 4 ('RTL') (line 350225)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0030, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_009)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO CS EN PDI; 4 ('RTL') (line 350226)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0030, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS ES B; 4 ('RTL') (line 350227)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x002B, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS ES S; 4 ('RTL') (line 350228)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x002B, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS ES WS; 4 ('RTL') (line 350229)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x002B, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS ES LRI; 4 ('RTL') (line 350230)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x002B, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS ES RLI; 4 ('RTL') (line 350231)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x002B, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS ES FSI; 4 ('RTL') (line 350232)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x002B, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS ES PDI; 4 ('RTL') (line 350233)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x002B, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS ET B; 4 ('RTL') (line 350234)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0023, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS ET S; 4 ('RTL') (line 350235)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0023, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS ET WS; 4 ('RTL') (line 350236)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0023, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS ET LRI; 4 ('RTL') (line 350237)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0023, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS ET RLI; 4 ('RTL') (line 350238)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0023, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS ET FSI; 4 ('RTL') (line 350239)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0023, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS ET PDI; 4 ('RTL') (line 350240)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0023, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS AN B; 4 ('RTL') (line 350241)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0660, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS AN S; 4 ('RTL') (line 350242)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0660, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS AN WS; 4 ('RTL') (line 350243)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0660, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS AN LRI; 4 ('RTL') (line 350244)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0660, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS AN RLI; 4 ('RTL') (line 350245)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0660, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS AN FSI; 4 ('RTL') (line 350246)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0660, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS AN PDI; 4 ('RTL') (line 350247)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0660, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS CS B; 4 ('RTL') (line 350248)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x002C, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS CS S; 4 ('RTL') (line 350249)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x002C, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS CS WS; 4 ('RTL') (line 350250)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x002C, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_010)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO CS CS LRI; 4 ('RTL') (line 350251)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x002C, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS CS RLI; 4 ('RTL') (line 350252)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x002C, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS CS FSI; 4 ('RTL') (line 350253)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x002C, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS CS PDI; 4 ('RTL') (line 350254)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x002C, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS NSM B; 4 ('RTL') (line 350255)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0300, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS NSM S; 4 ('RTL') (line 350256)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0300, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS NSM WS; 4 ('RTL') (line 350257)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0300, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS NSM LRI; 4 ('RTL') (line 350258)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0300, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS NSM RLI; 4 ('RTL') (line 350259)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0300, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS NSM FSI; 4 ('RTL') (line 350260)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0300, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS NSM PDI; 4 ('RTL') (line 350261)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0300, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS ON B; 4 ('RTL') (line 350262)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0021, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS ON S; 4 ('RTL') (line 350263)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0021, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS ON WS; 4 ('RTL') (line 350264)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0021, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS ON LRI; 4 ('RTL') (line 350265)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0021, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS ON RLI; 4 ('RTL') (line 350266)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0021, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS ON FSI; 4 ('RTL') (line 350267)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0021, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO CS ON PDI; 4 ('RTL') (line 350268)
        std::vector<uint32_t> const cps = { 0x202E, 0x002C, 0x0021, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM L B; 4 ('RTL') (line 350269)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0041, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM L S; 4 ('RTL') (line 350270)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0041, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM L WS; 4 ('RTL') (line 350271)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0041, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM L LRI; 4 ('RTL') (line 350272)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0041, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM L RLI; 4 ('RTL') (line 350273)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0041, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM L FSI; 4 ('RTL') (line 350274)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0041, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM L PDI; 4 ('RTL') (line 350275)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0041, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_011)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO NSM R B; 5 ('auto') (line 350276)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x05BE, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM R B; 5 ('RTL') (line 350276)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x05BE, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM R S; 5 ('auto') (line 350277)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x05BE, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM R S; 5 ('RTL') (line 350277)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x05BE, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM R WS; 5 ('auto') (line 350278)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x05BE, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM R WS; 5 ('RTL') (line 350278)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x05BE, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM R LRI; 5 ('auto') (line 350279)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x05BE, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM R LRI; 5 ('RTL') (line 350279)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x05BE, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM R RLI; 5 ('auto') (line 350280)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x05BE, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM R RLI; 5 ('RTL') (line 350280)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x05BE, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM R FSI; 5 ('auto') (line 350281)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x05BE, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM R FSI; 5 ('RTL') (line 350281)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x05BE, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM R PDI; 5 ('auto') (line 350282)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x05BE, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM R PDI; 5 ('RTL') (line 350282)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x05BE, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM AL B; 5 ('auto') (line 350283)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0608, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM AL B; 5 ('RTL') (line 350283)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0608, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM AL S; 5 ('auto') (line 350284)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0608, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM AL S; 5 ('RTL') (line 350284)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0608, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM AL WS; 5 ('auto') (line 350285)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0608, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM AL WS; 5 ('RTL') (line 350285)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0608, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM AL LRI; 5 ('auto') (line 350286)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0608, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM AL LRI; 5 ('RTL') (line 350286)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0608, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM AL RLI; 5 ('auto') (line 350287)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0608, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM AL RLI; 5 ('RTL') (line 350287)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0608, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM AL FSI; 5 ('auto') (line 350288)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0608, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM AL FSI; 5 ('RTL') (line 350288)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0608, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM AL PDI; 5 ('auto') (line 350289)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0608, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM AL PDI; 5 ('RTL') (line 350289)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0608, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM EN B; 4 ('RTL') (line 350290)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0030, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM EN S; 4 ('RTL') (line 350291)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0030, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM EN WS; 4 ('RTL') (line 350292)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0030, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM EN LRI; 4 ('RTL') (line 350293)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0030, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM EN RLI; 4 ('RTL') (line 350294)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0030, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM EN FSI; 4 ('RTL') (line 350295)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0030, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM EN PDI; 4 ('RTL') (line 350296)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0030, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM ES B; 4 ('RTL') (line 350297)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x002B, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM ES S; 4 ('RTL') (line 350298)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x002B, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM ES WS; 4 ('RTL') (line 350299)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x002B, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM ES LRI; 4 ('RTL') (line 350300)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x002B, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_012)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO NSM ES RLI; 4 ('RTL') (line 350301)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x002B, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM ES FSI; 4 ('RTL') (line 350302)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x002B, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM ES PDI; 4 ('RTL') (line 350303)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x002B, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM ET B; 4 ('RTL') (line 350304)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0023, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM ET S; 4 ('RTL') (line 350305)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0023, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM ET WS; 4 ('RTL') (line 350306)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0023, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM ET LRI; 4 ('RTL') (line 350307)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0023, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM ET RLI; 4 ('RTL') (line 350308)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0023, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM ET FSI; 4 ('RTL') (line 350309)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0023, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM ET PDI; 4 ('RTL') (line 350310)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0023, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM AN B; 4 ('RTL') (line 350311)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0660, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM AN S; 4 ('RTL') (line 350312)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0660, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM AN WS; 4 ('RTL') (line 350313)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0660, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM AN LRI; 4 ('RTL') (line 350314)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0660, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM AN RLI; 4 ('RTL') (line 350315)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0660, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM AN FSI; 4 ('RTL') (line 350316)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0660, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM AN PDI; 4 ('RTL') (line 350317)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0660, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM CS B; 4 ('RTL') (line 350318)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x002C, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM CS S; 4 ('RTL') (line 350319)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x002C, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM CS WS; 4 ('RTL') (line 350320)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x002C, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM CS LRI; 4 ('RTL') (line 350321)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x002C, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM CS RLI; 4 ('RTL') (line 350322)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x002C, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM CS FSI; 4 ('RTL') (line 350323)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x002C, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM CS PDI; 4 ('RTL') (line 350324)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x002C, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM NSM B; 4 ('RTL') (line 350325)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0300, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_013)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO NSM NSM S; 4 ('RTL') (line 350326)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0300, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM NSM WS; 4 ('RTL') (line 350327)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0300, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM NSM LRI; 4 ('RTL') (line 350328)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0300, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM NSM RLI; 4 ('RTL') (line 350329)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0300, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM NSM FSI; 4 ('RTL') (line 350330)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0300, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM NSM PDI; 4 ('RTL') (line 350331)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0300, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM ON B; 4 ('RTL') (line 350332)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0021, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM ON S; 4 ('RTL') (line 350333)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0021, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM ON WS; 4 ('RTL') (line 350334)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0021, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM ON LRI; 4 ('RTL') (line 350335)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0021, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM ON RLI; 4 ('RTL') (line 350336)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0021, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM ON FSI; 4 ('RTL') (line 350337)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0021, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO NSM ON PDI; 4 ('RTL') (line 350338)
        std::vector<uint32_t> const cps = { 0x202E, 0x0300, 0x0021, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS L B; 4 ('RTL') (line 350339)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0041, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS L S; 4 ('RTL') (line 350340)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0041, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS L WS; 4 ('RTL') (line 350341)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0041, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS L LRI; 4 ('RTL') (line 350342)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0041, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS L RLI; 4 ('RTL') (line 350343)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0041, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS L FSI; 4 ('RTL') (line 350344)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0041, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS L PDI; 4 ('RTL') (line 350345)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0041, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS R B; 5 ('auto') (line 350346)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x05BE, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS R B; 5 ('RTL') (line 350346)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x05BE, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS R S; 5 ('auto') (line 350347)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x05BE, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS R S; 5 ('RTL') (line 350347)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x05BE, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS R WS; 5 ('auto') (line 350348)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x05BE, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS R WS; 5 ('RTL') (line 350348)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x05BE, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS R LRI; 5 ('auto') (line 350349)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x05BE, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS R LRI; 5 ('RTL') (line 350349)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x05BE, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS R RLI; 5 ('auto') (line 350350)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x05BE, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS R RLI; 5 ('RTL') (line 350350)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x05BE, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_014)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO WS R FSI; 5 ('auto') (line 350351)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x05BE, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS R FSI; 5 ('RTL') (line 350351)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x05BE, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS R PDI; 5 ('auto') (line 350352)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x05BE, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS R PDI; 5 ('RTL') (line 350352)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x05BE, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS AL B; 5 ('auto') (line 350353)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0608, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS AL B; 5 ('RTL') (line 350353)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0608, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS AL S; 5 ('auto') (line 350354)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0608, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS AL S; 5 ('RTL') (line 350354)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0608, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS AL WS; 5 ('auto') (line 350355)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0608, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS AL WS; 5 ('RTL') (line 350355)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0608, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS AL LRI; 5 ('auto') (line 350356)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0608, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS AL LRI; 5 ('RTL') (line 350356)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0608, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS AL RLI; 5 ('auto') (line 350357)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0608, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS AL RLI; 5 ('RTL') (line 350357)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0608, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS AL FSI; 5 ('auto') (line 350358)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0608, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS AL FSI; 5 ('RTL') (line 350358)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0608, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS AL PDI; 5 ('auto') (line 350359)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0608, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS AL PDI; 5 ('RTL') (line 350359)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0608, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS EN B; 4 ('RTL') (line 350360)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0030, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS EN S; 4 ('RTL') (line 350361)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0030, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS EN WS; 4 ('RTL') (line 350362)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0030, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS EN LRI; 4 ('RTL') (line 350363)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0030, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS EN RLI; 4 ('RTL') (line 350364)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0030, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS EN FSI; 4 ('RTL') (line 350365)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0030, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS EN PDI; 4 ('RTL') (line 350366)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0030, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS ES B; 4 ('RTL') (line 350367)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x002B, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS ES S; 4 ('RTL') (line 350368)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x002B, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS ES WS; 4 ('RTL') (line 350369)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x002B, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS ES LRI; 4 ('RTL') (line 350370)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x002B, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS ES RLI; 4 ('RTL') (line 350371)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x002B, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS ES FSI; 4 ('RTL') (line 350372)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x002B, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS ES PDI; 4 ('RTL') (line 350373)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x002B, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS ET B; 4 ('RTL') (line 350374)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0023, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS ET S; 4 ('RTL') (line 350375)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0023, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_015)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO WS ET WS; 4 ('RTL') (line 350376)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0023, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS ET LRI; 4 ('RTL') (line 350377)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0023, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS ET RLI; 4 ('RTL') (line 350378)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0023, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS ET FSI; 4 ('RTL') (line 350379)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0023, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS ET PDI; 4 ('RTL') (line 350380)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0023, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS AN B; 4 ('RTL') (line 350381)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0660, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS AN S; 4 ('RTL') (line 350382)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0660, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS AN WS; 4 ('RTL') (line 350383)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0660, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS AN LRI; 4 ('RTL') (line 350384)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0660, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS AN RLI; 4 ('RTL') (line 350385)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0660, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS AN FSI; 4 ('RTL') (line 350386)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0660, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS AN PDI; 4 ('RTL') (line 350387)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0660, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS CS B; 4 ('RTL') (line 350388)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x002C, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS CS S; 4 ('RTL') (line 350389)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x002C, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS CS WS; 4 ('RTL') (line 350390)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x002C, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS CS LRI; 4 ('RTL') (line 350391)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x002C, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS CS RLI; 4 ('RTL') (line 350392)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x002C, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS CS FSI; 4 ('RTL') (line 350393)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x002C, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS CS PDI; 4 ('RTL') (line 350394)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x002C, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS NSM B; 4 ('RTL') (line 350395)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0300, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS NSM S; 4 ('RTL') (line 350396)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0300, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS NSM WS; 4 ('RTL') (line 350397)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0300, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS NSM LRI; 4 ('RTL') (line 350398)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0300, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS NSM RLI; 4 ('RTL') (line 350399)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0300, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS NSM FSI; 4 ('RTL') (line 350400)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0300, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_016)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO WS NSM PDI; 4 ('RTL') (line 350401)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0300, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS ON B; 4 ('RTL') (line 350402)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0021, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS ON S; 4 ('RTL') (line 350403)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0021, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS ON WS; 4 ('RTL') (line 350404)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0021, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS ON LRI; 4 ('RTL') (line 350405)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0021, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS ON RLI; 4 ('RTL') (line 350406)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0021, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS ON FSI; 4 ('RTL') (line 350407)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0021, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO WS ON PDI; 4 ('RTL') (line 350408)
        std::vector<uint32_t> const cps = { 0x202E, 0x0020, 0x0021, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON L B; 4 ('RTL') (line 350409)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0041, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON L S; 4 ('RTL') (line 350410)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0041, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON L WS; 4 ('RTL') (line 350411)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0041, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON L LRI; 4 ('RTL') (line 350412)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0041, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON L RLI; 4 ('RTL') (line 350413)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0041, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON L FSI; 4 ('RTL') (line 350414)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0041, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON L PDI; 4 ('RTL') (line 350415)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0041, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON R B; 5 ('auto') (line 350416)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x05BE, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON R B; 5 ('RTL') (line 350416)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x05BE, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON R S; 5 ('auto') (line 350417)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x05BE, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON R S; 5 ('RTL') (line 350417)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x05BE, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON R WS; 5 ('auto') (line 350418)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x05BE, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON R WS; 5 ('RTL') (line 350418)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x05BE, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON R LRI; 5 ('auto') (line 350419)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x05BE, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON R LRI; 5 ('RTL') (line 350419)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x05BE, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON R RLI; 5 ('auto') (line 350420)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x05BE, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON R RLI; 5 ('RTL') (line 350420)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x05BE, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON R FSI; 5 ('auto') (line 350421)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x05BE, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON R FSI; 5 ('RTL') (line 350421)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x05BE, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON R PDI; 5 ('auto') (line 350422)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x05BE, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON R PDI; 5 ('RTL') (line 350422)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x05BE, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON AL B; 5 ('auto') (line 350423)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0608, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON AL B; 5 ('RTL') (line 350423)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0608, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON AL S; 5 ('auto') (line 350424)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0608, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON AL S; 5 ('RTL') (line 350424)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0608, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON AL WS; 5 ('auto') (line 350425)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0608, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON AL WS; 5 ('RTL') (line 350425)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0608, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_017)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO ON AL LRI; 5 ('auto') (line 350426)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0608, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON AL LRI; 5 ('RTL') (line 350426)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0608, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON AL RLI; 5 ('auto') (line 350427)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0608, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON AL RLI; 5 ('RTL') (line 350427)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0608, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON AL FSI; 5 ('auto') (line 350428)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0608, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON AL FSI; 5 ('RTL') (line 350428)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0608, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON AL PDI; 5 ('auto') (line 350429)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0608, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON AL PDI; 5 ('RTL') (line 350429)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0608, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON EN B; 4 ('RTL') (line 350430)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0030, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON EN S; 4 ('RTL') (line 350431)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0030, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON EN WS; 4 ('RTL') (line 350432)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0030, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON EN LRI; 4 ('RTL') (line 350433)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0030, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON EN RLI; 4 ('RTL') (line 350434)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0030, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON EN FSI; 4 ('RTL') (line 350435)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0030, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON EN PDI; 4 ('RTL') (line 350436)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0030, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON ES B; 4 ('RTL') (line 350437)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x002B, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON ES S; 4 ('RTL') (line 350438)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x002B, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON ES WS; 4 ('RTL') (line 350439)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x002B, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON ES LRI; 4 ('RTL') (line 350440)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x002B, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON ES RLI; 4 ('RTL') (line 350441)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x002B, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON ES FSI; 4 ('RTL') (line 350442)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x002B, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON ES PDI; 4 ('RTL') (line 350443)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x002B, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON ET B; 4 ('RTL') (line 350444)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0023, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON ET S; 4 ('RTL') (line 350445)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0023, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON ET WS; 4 ('RTL') (line 350446)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0023, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON ET LRI; 4 ('RTL') (line 350447)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0023, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON ET RLI; 4 ('RTL') (line 350448)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0023, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON ET FSI; 4 ('RTL') (line 350449)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0023, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON ET PDI; 4 ('RTL') (line 350450)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0023, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_018)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO ON AN B; 4 ('RTL') (line 350451)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0660, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON AN S; 4 ('RTL') (line 350452)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0660, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON AN WS; 4 ('RTL') (line 350453)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0660, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON AN LRI; 4 ('RTL') (line 350454)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0660, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON AN RLI; 4 ('RTL') (line 350455)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0660, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON AN FSI; 4 ('RTL') (line 350456)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0660, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON AN PDI; 4 ('RTL') (line 350457)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0660, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON CS B; 4 ('RTL') (line 350458)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x002C, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON CS S; 4 ('RTL') (line 350459)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x002C, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON CS WS; 4 ('RTL') (line 350460)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x002C, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON CS LRI; 4 ('RTL') (line 350461)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x002C, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON CS RLI; 4 ('RTL') (line 350462)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x002C, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON CS FSI; 4 ('RTL') (line 350463)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x002C, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON CS PDI; 4 ('RTL') (line 350464)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x002C, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON NSM B; 4 ('RTL') (line 350465)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0300, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON NSM S; 4 ('RTL') (line 350466)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0300, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON NSM WS; 4 ('RTL') (line 350467)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0300, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON NSM LRI; 4 ('RTL') (line 350468)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0300, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON NSM RLI; 4 ('RTL') (line 350469)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0300, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON NSM FSI; 4 ('RTL') (line 350470)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0300, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON NSM PDI; 4 ('RTL') (line 350471)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0300, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON ON B; 4 ('RTL') (line 350472)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0021, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON ON S; 4 ('RTL') (line 350473)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0021, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON ON WS; 4 ('RTL') (line 350474)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0021, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON ON LRI; 4 ('RTL') (line 350475)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0021, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_019)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO ON ON RLI; 4 ('RTL') (line 350476)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0021, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON ON FSI; 4 ('RTL') (line 350477)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0021, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO ON ON PDI; 4 ('RTL') (line 350478)
        std::vector<uint32_t> const cps = { 0x202E, 0x0021, 0x0021, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI L B; 4 ('RTL') (line 350479)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0041, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI L S; 4 ('RTL') (line 350480)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0041, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI L WS; 4 ('RTL') (line 350481)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0041, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI L LRI; 4 ('RTL') (line 350482)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0041, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI L RLI; 4 ('RTL') (line 350483)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0041, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI L FSI; 4 ('RTL') (line 350484)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0041, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI L PDI; 4 ('RTL') (line 350485)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0041, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI R B; 5 ('auto') (line 350486)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x05BE, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI R B; 5 ('RTL') (line 350486)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x05BE, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI R S; 5 ('auto') (line 350487)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x05BE, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI R S; 5 ('RTL') (line 350487)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x05BE, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI R WS; 5 ('auto') (line 350488)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x05BE, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI R WS; 5 ('RTL') (line 350488)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x05BE, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI R LRI; 5 ('auto') (line 350489)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x05BE, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI R LRI; 5 ('RTL') (line 350489)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x05BE, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI R RLI; 5 ('auto') (line 350490)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x05BE, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI R RLI; 5 ('RTL') (line 350490)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x05BE, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI R FSI; 5 ('auto') (line 350491)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x05BE, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI R FSI; 5 ('RTL') (line 350491)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x05BE, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI R PDI; 5 ('auto') (line 350492)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x05BE, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI R PDI; 5 ('RTL') (line 350492)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x05BE, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI AL B; 5 ('auto') (line 350493)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0608, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI AL B; 5 ('RTL') (line 350493)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0608, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI AL S; 5 ('auto') (line 350494)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0608, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI AL S; 5 ('RTL') (line 350494)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0608, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI AL WS; 5 ('auto') (line 350495)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0608, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI AL WS; 5 ('RTL') (line 350495)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0608, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI AL LRI; 5 ('auto') (line 350496)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0608, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI AL LRI; 5 ('RTL') (line 350496)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0608, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI AL RLI; 5 ('auto') (line 350497)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0608, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI AL RLI; 5 ('RTL') (line 350497)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0608, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI AL FSI; 5 ('auto') (line 350498)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0608, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI AL FSI; 5 ('RTL') (line 350498)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0608, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI AL PDI; 5 ('auto') (line 350499)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0608, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI AL PDI; 5 ('RTL') (line 350499)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0608, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI EN B; 4 ('RTL') (line 350500)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0030, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_020)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO PDI EN S; 4 ('RTL') (line 350501)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0030, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI EN WS; 4 ('RTL') (line 350502)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0030, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI EN LRI; 4 ('RTL') (line 350503)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0030, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI EN RLI; 4 ('RTL') (line 350504)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0030, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI EN FSI; 4 ('RTL') (line 350505)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0030, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI EN PDI; 4 ('RTL') (line 350506)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0030, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI ES B; 4 ('RTL') (line 350507)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x002B, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI ES S; 4 ('RTL') (line 350508)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x002B, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI ES WS; 4 ('RTL') (line 350509)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x002B, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI ES LRI; 4 ('RTL') (line 350510)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x002B, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI ES RLI; 4 ('RTL') (line 350511)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x002B, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI ES FSI; 4 ('RTL') (line 350512)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x002B, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI ES PDI; 4 ('RTL') (line 350513)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x002B, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI ET B; 4 ('RTL') (line 350514)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0023, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI ET S; 4 ('RTL') (line 350515)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0023, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI ET WS; 4 ('RTL') (line 350516)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0023, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI ET LRI; 4 ('RTL') (line 350517)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0023, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI ET RLI; 4 ('RTL') (line 350518)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0023, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI ET FSI; 4 ('RTL') (line 350519)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0023, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI ET PDI; 4 ('RTL') (line 350520)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0023, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI AN B; 4 ('RTL') (line 350521)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0660, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI AN S; 4 ('RTL') (line 350522)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0660, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI AN WS; 4 ('RTL') (line 350523)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0660, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI AN LRI; 4 ('RTL') (line 350524)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0660, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI AN RLI; 4 ('RTL') (line 350525)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0660, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_021)
{

    expected_levels = { -1, 3, 3, 1 };

    {
        // RLO PDI AN FSI; 4 ('RTL') (line 350526)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0660, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI AN PDI; 4 ('RTL') (line 350527)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0660, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI CS B; 4 ('RTL') (line 350528)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x002C, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI CS S; 4 ('RTL') (line 350529)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x002C, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI CS WS; 4 ('RTL') (line 350530)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x002C, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI CS LRI; 4 ('RTL') (line 350531)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x002C, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI CS RLI; 4 ('RTL') (line 350532)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x002C, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI CS FSI; 4 ('RTL') (line 350533)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x002C, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI CS PDI; 4 ('RTL') (line 350534)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x002C, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI NSM B; 4 ('RTL') (line 350535)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0300, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI NSM S; 4 ('RTL') (line 350536)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0300, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI NSM WS; 4 ('RTL') (line 350537)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0300, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI NSM LRI; 4 ('RTL') (line 350538)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0300, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI NSM RLI; 4 ('RTL') (line 350539)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0300, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI NSM FSI; 4 ('RTL') (line 350540)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0300, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI NSM PDI; 4 ('RTL') (line 350541)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0300, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI ON B; 4 ('RTL') (line 350542)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0021, 0x2029 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI ON S; 4 ('RTL') (line 350543)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0021, 0x0009 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI ON WS; 4 ('RTL') (line 350544)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0021, 0x0020 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI ON LRI; 4 ('RTL') (line 350545)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0021, 0x2066 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI ON RLI; 4 ('RTL') (line 350546)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0021, 0x2067 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI ON FSI; 4 ('RTL') (line 350547)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0021, 0x2068 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLO PDI ON PDI; 4 ('RTL') (line 350548)
        std::vector<uint32_t> const cps = { 0x202E, 0x2069, 0x0021, 0x2069 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    expected_levels = { -1, 3, 3, 2 };

    {
        // LRE R R L; 7 ('auto') (line 350554)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x0041 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R R L; 7 ('LTR') (line 350554)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x0041 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R R L; 7 ('RTL') (line 350554)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x0041 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R R ES; 7 ('auto') (line 350555)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R R ES; 7 ('LTR') (line 350555)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R R ES; 7 ('RTL') (line 350555)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_022)
{

    expected_levels = { -1, 3, 3, 2 };

    {
        // LRE R R ET; 7 ('auto') (line 350556)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R R ET; 7 ('LTR') (line 350556)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R R ET; 7 ('RTL') (line 350556)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R R CS; 7 ('auto') (line 350557)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R R CS; 7 ('LTR') (line 350557)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R R CS; 7 ('RTL') (line 350557)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R R ON; 7 ('auto') (line 350558)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R R ON; 7 ('LTR') (line 350558)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R R ON; 7 ('RTL') (line 350558)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL L; 7 ('auto') (line 350559)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x0041 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL L; 7 ('LTR') (line 350559)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x0041 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL L; 7 ('RTL') (line 350559)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x0041 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL ES; 7 ('auto') (line 350560)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL ES; 7 ('LTR') (line 350560)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL ES; 7 ('RTL') (line 350560)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL ET; 7 ('auto') (line 350561)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL ET; 7 ('LTR') (line 350561)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL ET; 7 ('RTL') (line 350561)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL CS; 7 ('auto') (line 350562)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL CS; 7 ('LTR') (line 350562)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL CS; 7 ('RTL') (line 350562)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL ON; 7 ('auto') (line 350563)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL ON; 7 ('LTR') (line 350563)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL ON; 7 ('RTL') (line 350563)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM L; 7 ('auto') (line 350564)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x0041 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM L; 7 ('LTR') (line 350564)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x0041 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM L; 7 ('RTL') (line 350564)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x0041 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM ES; 7 ('auto') (line 350565)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM ES; 7 ('LTR') (line 350565)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM ES; 7 ('RTL') (line 350565)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM ET; 7 ('auto') (line 350566)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM ET; 7 ('LTR') (line 350566)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM ET; 7 ('RTL') (line 350566)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM CS; 7 ('auto') (line 350567)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM CS; 7 ('LTR') (line 350567)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM CS; 7 ('RTL') (line 350567)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM ON; 7 ('auto') (line 350568)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM ON; 7 ('LTR') (line 350568)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM ON; 7 ('RTL') (line 350568)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R L; 7 ('auto') (line 350569)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x0041 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R L; 7 ('LTR') (line 350569)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x0041 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R L; 7 ('RTL') (line 350569)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x0041 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R ES; 7 ('auto') (line 350570)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R ES; 7 ('LTR') (line 350570)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R ES; 7 ('RTL') (line 350570)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R ET; 7 ('auto') (line 350571)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R ET; 7 ('LTR') (line 350571)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R ET; 7 ('RTL') (line 350571)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R CS; 7 ('auto') (line 350572)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R CS; 7 ('LTR') (line 350572)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R CS; 7 ('RTL') (line 350572)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R ON; 7 ('auto') (line 350573)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R ON; 7 ('LTR') (line 350573)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R ON; 7 ('RTL') (line 350573)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL L; 7 ('auto') (line 350574)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x0041 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL L; 7 ('LTR') (line 350574)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x0041 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL L; 7 ('RTL') (line 350574)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x0041 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL ES; 7 ('auto') (line 350575)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL ES; 7 ('LTR') (line 350575)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL ES; 7 ('RTL') (line 350575)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL ET; 7 ('auto') (line 350576)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL ET; 7 ('LTR') (line 350576)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL ET; 7 ('RTL') (line 350576)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL CS; 7 ('auto') (line 350577)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL CS; 7 ('LTR') (line 350577)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL CS; 7 ('RTL') (line 350577)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL ON; 7 ('auto') (line 350578)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL ON; 7 ('LTR') (line 350578)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL ON; 7 ('RTL') (line 350578)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM L; 7 ('auto') (line 350579)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x0041 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM L; 7 ('LTR') (line 350579)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x0041 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM L; 7 ('RTL') (line 350579)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x0041 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM ES; 7 ('auto') (line 350580)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM ES; 7 ('LTR') (line 350580)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM ES; 7 ('RTL') (line 350580)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_023)
{

    expected_levels = { -1, 3, 3, 2 };

    {
        // LRE AL NSM ET; 7 ('auto') (line 350581)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM ET; 7 ('LTR') (line 350581)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM ET; 7 ('RTL') (line 350581)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM CS; 7 ('auto') (line 350582)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM CS; 7 ('LTR') (line 350582)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM CS; 7 ('RTL') (line 350582)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM ON; 7 ('auto') (line 350583)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM ON; 7 ('LTR') (line 350583)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM ON; 7 ('RTL') (line 350583)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    expected_levels = { -1, 3, 3, 3 };

    {
        // LRE R R R; 7 ('auto') (line 350589)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R R R; 7 ('LTR') (line 350589)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R R R; 7 ('RTL') (line 350589)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R R AL; 7 ('auto') (line 350590)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R R AL; 7 ('LTR') (line 350590)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R R AL; 7 ('RTL') (line 350590)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R R NSM; 7 ('auto') (line 350591)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R R NSM; 7 ('LTR') (line 350591)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R R NSM; 7 ('RTL') (line 350591)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x05BE, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL R; 7 ('auto') (line 350592)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL R; 7 ('LTR') (line 350592)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL R; 7 ('RTL') (line 350592)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL AL; 7 ('auto') (line 350593)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL AL; 7 ('LTR') (line 350593)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL AL; 7 ('RTL') (line 350593)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL NSM; 7 ('auto') (line 350594)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL NSM; 7 ('LTR') (line 350594)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R AL NSM; 7 ('RTL') (line 350594)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0608, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R ES R; 7 ('auto') (line 350595)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x002B, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R ES R; 7 ('LTR') (line 350595)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x002B, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R ES R; 7 ('RTL') (line 350595)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x002B, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R ES AL; 7 ('auto') (line 350596)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x002B, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R ES AL; 7 ('LTR') (line 350596)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x002B, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R ES AL; 7 ('RTL') (line 350596)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x002B, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R ET R; 7 ('auto') (line 350597)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0023, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R ET R; 7 ('LTR') (line 350597)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0023, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R ET R; 7 ('RTL') (line 350597)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0023, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R ET AL; 7 ('auto') (line 350598)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0023, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R ET AL; 7 ('LTR') (line 350598)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0023, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R ET AL; 7 ('RTL') (line 350598)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0023, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R CS R; 7 ('auto') (line 350599)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x002C, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R CS R; 7 ('LTR') (line 350599)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x002C, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R CS R; 7 ('RTL') (line 350599)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x002C, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R CS AL; 7 ('auto') (line 350600)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x002C, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R CS AL; 7 ('LTR') (line 350600)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x002C, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R CS AL; 7 ('RTL') (line 350600)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x002C, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM R; 7 ('auto') (line 350601)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM R; 7 ('LTR') (line 350601)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM R; 7 ('RTL') (line 350601)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM AL; 7 ('auto') (line 350602)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM AL; 7 ('LTR') (line 350602)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM AL; 7 ('RTL') (line 350602)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM NSM; 7 ('auto') (line 350603)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM NSM; 7 ('LTR') (line 350603)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R NSM NSM; 7 ('RTL') (line 350603)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0300, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R WS R; 7 ('auto') (line 350604)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0020, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R WS R; 7 ('LTR') (line 350604)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0020, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R WS R; 7 ('RTL') (line 350604)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0020, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R WS AL; 7 ('auto') (line 350605)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0020, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R WS AL; 7 ('LTR') (line 350605)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0020, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R WS AL; 7 ('RTL') (line 350605)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0020, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R ON R; 7 ('auto') (line 350606)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0021, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R ON R; 7 ('LTR') (line 350606)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0021, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R ON R; 7 ('RTL') (line 350606)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0021, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R ON AL; 7 ('auto') (line 350607)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0021, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R ON AL; 7 ('LTR') (line 350607)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0021, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R ON AL; 7 ('RTL') (line 350607)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x0021, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R PDI R; 7 ('auto') (line 350608)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x2069, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R PDI R; 7 ('LTR') (line 350608)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x2069, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R PDI R; 7 ('RTL') (line 350608)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x2069, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R PDI AL; 7 ('auto') (line 350609)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x2069, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R PDI AL; 7 ('LTR') (line 350609)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x2069, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE R PDI AL; 7 ('RTL') (line 350609)
        std::vector<uint32_t> const cps = { 0x202A, 0x05BE, 0x2069, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R R; 7 ('auto') (line 350610)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R R; 7 ('LTR') (line 350610)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R R; 7 ('RTL') (line 350610)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_024)
{

    expected_levels = { -1, 3, 3, 3 };

    {
        // LRE AL R AL; 7 ('auto') (line 350611)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R AL; 7 ('LTR') (line 350611)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R AL; 7 ('RTL') (line 350611)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R NSM; 7 ('auto') (line 350612)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R NSM; 7 ('LTR') (line 350612)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL R NSM; 7 ('RTL') (line 350612)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x05BE, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL R; 7 ('auto') (line 350613)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL R; 7 ('LTR') (line 350613)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL R; 7 ('RTL') (line 350613)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL AL; 7 ('auto') (line 350614)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL AL; 7 ('LTR') (line 350614)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL AL; 7 ('RTL') (line 350614)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL NSM; 7 ('auto') (line 350615)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL NSM; 7 ('LTR') (line 350615)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL AL NSM; 7 ('RTL') (line 350615)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0608, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL ES R; 7 ('auto') (line 350616)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x002B, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL ES R; 7 ('LTR') (line 350616)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x002B, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL ES R; 7 ('RTL') (line 350616)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x002B, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL ES AL; 7 ('auto') (line 350617)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x002B, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL ES AL; 7 ('LTR') (line 350617)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x002B, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL ES AL; 7 ('RTL') (line 350617)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x002B, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL ET R; 7 ('auto') (line 350618)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0023, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL ET R; 7 ('LTR') (line 350618)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0023, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL ET R; 7 ('RTL') (line 350618)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0023, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL ET AL; 7 ('auto') (line 350619)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0023, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL ET AL; 7 ('LTR') (line 350619)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0023, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL ET AL; 7 ('RTL') (line 350619)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0023, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL CS R; 7 ('auto') (line 350620)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x002C, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL CS R; 7 ('LTR') (line 350620)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x002C, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL CS R; 7 ('RTL') (line 350620)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x002C, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL CS AL; 7 ('auto') (line 350621)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x002C, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL CS AL; 7 ('LTR') (line 350621)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x002C, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL CS AL; 7 ('RTL') (line 350621)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x002C, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM R; 7 ('auto') (line 350622)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM R; 7 ('LTR') (line 350622)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM R; 7 ('RTL') (line 350622)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM AL; 7 ('auto') (line 350623)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM AL; 7 ('LTR') (line 350623)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM AL; 7 ('RTL') (line 350623)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM NSM; 7 ('auto') (line 350624)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM NSM; 7 ('LTR') (line 350624)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL NSM NSM; 7 ('RTL') (line 350624)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0300, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL WS R; 7 ('auto') (line 350625)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0020, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL WS R; 7 ('LTR') (line 350625)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0020, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL WS R; 7 ('RTL') (line 350625)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0020, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL WS AL; 7 ('auto') (line 350626)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0020, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL WS AL; 7 ('LTR') (line 350626)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0020, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL WS AL; 7 ('RTL') (line 350626)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0020, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL ON R; 7 ('auto') (line 350627)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0021, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL ON R; 7 ('LTR') (line 350627)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0021, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL ON R; 7 ('RTL') (line 350627)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0021, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL ON AL; 7 ('auto') (line 350628)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0021, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL ON AL; 7 ('LTR') (line 350628)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0021, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL ON AL; 7 ('RTL') (line 350628)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x0021, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL PDI R; 7 ('auto') (line 350629)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x2069, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL PDI R; 7 ('LTR') (line 350629)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x2069, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL PDI R; 7 ('RTL') (line 350629)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x2069, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL PDI AL; 7 ('auto') (line 350630)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x2069, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL PDI AL; 7 ('LTR') (line 350630)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x2069, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 0);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // LRE AL PDI AL; 7 ('RTL') (line 350630)
        std::vector<uint32_t> const cps = { 0x202A, 0x0608, 0x2069, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R R R; 5 ('auto') (line 350631)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x05BE, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R R R; 5 ('RTL') (line 350631)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x05BE, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R R AL; 5 ('auto') (line 350632)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x05BE, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R R AL; 5 ('RTL') (line 350632)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x05BE, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R R ES; 5 ('auto') (line 350633)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x05BE, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R R ES; 5 ('RTL') (line 350633)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x05BE, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R R ET; 5 ('auto') (line 350634)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x05BE, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R R ET; 5 ('RTL') (line 350634)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x05BE, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R R CS; 5 ('auto') (line 350635)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x05BE, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R R CS; 5 ('RTL') (line 350635)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x05BE, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_025)
{

    expected_levels = { -1, 3, 3, 3 };

    {
        // RLE R R NSM; 5 ('auto') (line 350636)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x05BE, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R R NSM; 5 ('RTL') (line 350636)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x05BE, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R R ON; 5 ('auto') (line 350637)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x05BE, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R R ON; 5 ('RTL') (line 350637)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x05BE, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R AL R; 5 ('auto') (line 350638)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0608, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R AL R; 5 ('RTL') (line 350638)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0608, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R AL AL; 5 ('auto') (line 350639)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0608, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R AL AL; 5 ('RTL') (line 350639)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0608, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R AL ES; 5 ('auto') (line 350640)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0608, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R AL ES; 5 ('RTL') (line 350640)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0608, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R AL ET; 5 ('auto') (line 350641)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0608, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R AL ET; 5 ('RTL') (line 350641)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0608, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R AL CS; 5 ('auto') (line 350642)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0608, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R AL CS; 5 ('RTL') (line 350642)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0608, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R AL NSM; 5 ('auto') (line 350643)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0608, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R AL NSM; 5 ('RTL') (line 350643)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0608, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R AL ON; 5 ('auto') (line 350644)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0608, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R AL ON; 5 ('RTL') (line 350644)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0608, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ES R; 5 ('auto') (line 350645)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002B, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ES R; 5 ('RTL') (line 350645)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002B, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ES AL; 5 ('auto') (line 350646)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002B, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ES AL; 5 ('RTL') (line 350646)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002B, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ES ES; 5 ('auto') (line 350647)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002B, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ES ES; 5 ('RTL') (line 350647)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002B, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ES ET; 5 ('auto') (line 350648)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002B, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ES ET; 5 ('RTL') (line 350648)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002B, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ES CS; 5 ('auto') (line 350649)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002B, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ES CS; 5 ('RTL') (line 350649)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002B, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ES NSM; 5 ('auto') (line 350650)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002B, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ES NSM; 5 ('RTL') (line 350650)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002B, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ES ON; 5 ('auto') (line 350651)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002B, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ES ON; 5 ('RTL') (line 350651)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002B, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ET R; 5 ('auto') (line 350652)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0023, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ET R; 5 ('RTL') (line 350652)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0023, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ET AL; 5 ('auto') (line 350653)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0023, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ET AL; 5 ('RTL') (line 350653)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0023, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ET ES; 5 ('auto') (line 350654)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0023, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ET ES; 5 ('RTL') (line 350654)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0023, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ET ET; 5 ('auto') (line 350655)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0023, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ET ET; 5 ('RTL') (line 350655)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0023, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ET CS; 5 ('auto') (line 350656)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0023, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ET CS; 5 ('RTL') (line 350656)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0023, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ET NSM; 5 ('auto') (line 350657)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0023, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ET NSM; 5 ('RTL') (line 350657)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0023, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ET ON; 5 ('auto') (line 350658)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0023, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ET ON; 5 ('RTL') (line 350658)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0023, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R CS R; 5 ('auto') (line 350659)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002C, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R CS R; 5 ('RTL') (line 350659)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002C, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R CS AL; 5 ('auto') (line 350660)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002C, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R CS AL; 5 ('RTL') (line 350660)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002C, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_026)
{

    expected_levels = { -1, 3, 3, 3 };

    {
        // RLE R CS ES; 5 ('auto') (line 350661)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002C, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R CS ES; 5 ('RTL') (line 350661)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002C, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R CS ET; 5 ('auto') (line 350662)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002C, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R CS ET; 5 ('RTL') (line 350662)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002C, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R CS CS; 5 ('auto') (line 350663)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002C, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R CS CS; 5 ('RTL') (line 350663)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002C, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R CS NSM; 5 ('auto') (line 350664)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002C, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R CS NSM; 5 ('RTL') (line 350664)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002C, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R CS ON; 5 ('auto') (line 350665)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002C, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R CS ON; 5 ('RTL') (line 350665)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x002C, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R NSM R; 5 ('auto') (line 350666)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0300, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R NSM R; 5 ('RTL') (line 350666)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0300, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R NSM AL; 5 ('auto') (line 350667)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0300, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R NSM AL; 5 ('RTL') (line 350667)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0300, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R NSM ES; 5 ('auto') (line 350668)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0300, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R NSM ES; 5 ('RTL') (line 350668)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0300, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R NSM ET; 5 ('auto') (line 350669)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0300, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R NSM ET; 5 ('RTL') (line 350669)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0300, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R NSM CS; 5 ('auto') (line 350670)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0300, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R NSM CS; 5 ('RTL') (line 350670)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0300, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R NSM NSM; 5 ('auto') (line 350671)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0300, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R NSM NSM; 5 ('RTL') (line 350671)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0300, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R NSM ON; 5 ('auto') (line 350672)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0300, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R NSM ON; 5 ('RTL') (line 350672)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0300, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R WS R; 5 ('auto') (line 350673)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0020, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R WS R; 5 ('RTL') (line 350673)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0020, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R WS AL; 5 ('auto') (line 350674)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0020, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R WS AL; 5 ('RTL') (line 350674)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0020, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R WS ES; 5 ('auto') (line 350675)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0020, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R WS ES; 5 ('RTL') (line 350675)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0020, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R WS ET; 5 ('auto') (line 350676)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0020, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R WS ET; 5 ('RTL') (line 350676)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0020, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R WS CS; 5 ('auto') (line 350677)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0020, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R WS CS; 5 ('RTL') (line 350677)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0020, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R WS NSM; 5 ('auto') (line 350678)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0020, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R WS NSM; 5 ('RTL') (line 350678)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0020, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R WS ON; 5 ('auto') (line 350679)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0020, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R WS ON; 5 ('RTL') (line 350679)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0020, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ON R; 5 ('auto') (line 350680)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0021, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ON R; 5 ('RTL') (line 350680)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0021, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ON AL; 5 ('auto') (line 350681)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0021, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ON AL; 5 ('RTL') (line 350681)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0021, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ON ES; 5 ('auto') (line 350682)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0021, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ON ES; 5 ('RTL') (line 350682)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0021, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ON ET; 5 ('auto') (line 350683)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0021, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ON ET; 5 ('RTL') (line 350683)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0021, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ON CS; 5 ('auto') (line 350684)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0021, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ON CS; 5 ('RTL') (line 350684)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0021, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ON NSM; 5 ('auto') (line 350685)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0021, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ON NSM; 5 ('RTL') (line 350685)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0021, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_027)
{

    expected_levels = { -1, 3, 3, 3 };

    {
        // RLE R ON ON; 5 ('auto') (line 350686)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0021, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R ON ON; 5 ('RTL') (line 350686)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x0021, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R PDI R; 5 ('auto') (line 350687)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x2069, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R PDI R; 5 ('RTL') (line 350687)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x2069, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R PDI AL; 5 ('auto') (line 350688)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x2069, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R PDI AL; 5 ('RTL') (line 350688)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x2069, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R PDI ES; 5 ('auto') (line 350689)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x2069, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R PDI ES; 5 ('RTL') (line 350689)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x2069, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R PDI ET; 5 ('auto') (line 350690)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x2069, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R PDI ET; 5 ('RTL') (line 350690)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x2069, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R PDI CS; 5 ('auto') (line 350691)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x2069, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R PDI CS; 5 ('RTL') (line 350691)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x2069, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R PDI NSM; 5 ('auto') (line 350692)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x2069, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R PDI NSM; 5 ('RTL') (line 350692)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x2069, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R PDI ON; 5 ('auto') (line 350693)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x2069, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE R PDI ON; 5 ('RTL') (line 350693)
        std::vector<uint32_t> const cps = { 0x202B, 0x05BE, 0x2069, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL R R; 5 ('auto') (line 350694)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x05BE, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL R R; 5 ('RTL') (line 350694)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x05BE, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL R AL; 5 ('auto') (line 350695)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x05BE, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL R AL; 5 ('RTL') (line 350695)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x05BE, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL R ES; 5 ('auto') (line 350696)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x05BE, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL R ES; 5 ('RTL') (line 350696)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x05BE, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL R ET; 5 ('auto') (line 350697)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x05BE, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL R ET; 5 ('RTL') (line 350697)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x05BE, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL R CS; 5 ('auto') (line 350698)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x05BE, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL R CS; 5 ('RTL') (line 350698)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x05BE, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL R NSM; 5 ('auto') (line 350699)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x05BE, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL R NSM; 5 ('RTL') (line 350699)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x05BE, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL R ON; 5 ('auto') (line 350700)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x05BE, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL R ON; 5 ('RTL') (line 350700)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x05BE, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL AL R; 5 ('auto') (line 350701)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0608, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL AL R; 5 ('RTL') (line 350701)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0608, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL AL AL; 5 ('auto') (line 350702)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0608, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL AL AL; 5 ('RTL') (line 350702)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0608, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL AL ES; 5 ('auto') (line 350703)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0608, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL AL ES; 5 ('RTL') (line 350703)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0608, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL AL ET; 5 ('auto') (line 350704)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0608, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL AL ET; 5 ('RTL') (line 350704)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0608, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL AL CS; 5 ('auto') (line 350705)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0608, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL AL CS; 5 ('RTL') (line 350705)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0608, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL AL NSM; 5 ('auto') (line 350706)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0608, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL AL NSM; 5 ('RTL') (line 350706)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0608, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL AL ON; 5 ('auto') (line 350707)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0608, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL AL ON; 5 ('RTL') (line 350707)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0608, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ES R; 5 ('auto') (line 350708)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002B, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ES R; 5 ('RTL') (line 350708)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002B, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ES AL; 5 ('auto') (line 350709)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002B, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ES AL; 5 ('RTL') (line 350709)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002B, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ES ES; 5 ('auto') (line 350710)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002B, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ES ES; 5 ('RTL') (line 350710)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002B, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_028)
{

    expected_levels = { -1, 3, 3, 3 };

    {
        // RLE AL ES ET; 5 ('auto') (line 350711)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002B, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ES ET; 5 ('RTL') (line 350711)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002B, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ES CS; 5 ('auto') (line 350712)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002B, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ES CS; 5 ('RTL') (line 350712)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002B, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ES NSM; 5 ('auto') (line 350713)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002B, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ES NSM; 5 ('RTL') (line 350713)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002B, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ES ON; 5 ('auto') (line 350714)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002B, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ES ON; 5 ('RTL') (line 350714)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002B, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ET R; 5 ('auto') (line 350715)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0023, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ET R; 5 ('RTL') (line 350715)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0023, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ET AL; 5 ('auto') (line 350716)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0023, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ET AL; 5 ('RTL') (line 350716)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0023, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ET ES; 5 ('auto') (line 350717)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0023, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ET ES; 5 ('RTL') (line 350717)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0023, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ET ET; 5 ('auto') (line 350718)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0023, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ET ET; 5 ('RTL') (line 350718)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0023, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ET CS; 5 ('auto') (line 350719)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0023, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ET CS; 5 ('RTL') (line 350719)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0023, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ET NSM; 5 ('auto') (line 350720)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0023, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ET NSM; 5 ('RTL') (line 350720)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0023, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ET ON; 5 ('auto') (line 350721)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0023, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ET ON; 5 ('RTL') (line 350721)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0023, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL CS R; 5 ('auto') (line 350722)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002C, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL CS R; 5 ('RTL') (line 350722)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002C, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL CS AL; 5 ('auto') (line 350723)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002C, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL CS AL; 5 ('RTL') (line 350723)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002C, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL CS ES; 5 ('auto') (line 350724)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002C, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL CS ES; 5 ('RTL') (line 350724)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002C, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL CS ET; 5 ('auto') (line 350725)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002C, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL CS ET; 5 ('RTL') (line 350725)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002C, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL CS CS; 5 ('auto') (line 350726)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002C, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL CS CS; 5 ('RTL') (line 350726)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002C, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL CS NSM; 5 ('auto') (line 350727)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002C, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL CS NSM; 5 ('RTL') (line 350727)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002C, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL CS ON; 5 ('auto') (line 350728)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002C, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL CS ON; 5 ('RTL') (line 350728)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x002C, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL NSM R; 5 ('auto') (line 350729)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0300, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL NSM R; 5 ('RTL') (line 350729)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0300, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL NSM AL; 5 ('auto') (line 350730)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0300, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL NSM AL; 5 ('RTL') (line 350730)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0300, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL NSM ES; 5 ('auto') (line 350731)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0300, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL NSM ES; 5 ('RTL') (line 350731)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0300, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL NSM ET; 5 ('auto') (line 350732)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0300, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL NSM ET; 5 ('RTL') (line 350732)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0300, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL NSM CS; 5 ('auto') (line 350733)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0300, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL NSM CS; 5 ('RTL') (line 350733)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0300, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL NSM NSM; 5 ('auto') (line 350734)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0300, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL NSM NSM; 5 ('RTL') (line 350734)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0300, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL NSM ON; 5 ('auto') (line 350735)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0300, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL NSM ON; 5 ('RTL') (line 350735)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0300, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_029)
{

    expected_levels = { -1, 3, 3, 3 };

    {
        // RLE AL WS R; 5 ('auto') (line 350736)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0020, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL WS R; 5 ('RTL') (line 350736)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0020, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL WS AL; 5 ('auto') (line 350737)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0020, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL WS AL; 5 ('RTL') (line 350737)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0020, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL WS ES; 5 ('auto') (line 350738)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0020, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL WS ES; 5 ('RTL') (line 350738)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0020, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL WS ET; 5 ('auto') (line 350739)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0020, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL WS ET; 5 ('RTL') (line 350739)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0020, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL WS CS; 5 ('auto') (line 350740)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0020, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL WS CS; 5 ('RTL') (line 350740)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0020, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL WS NSM; 5 ('auto') (line 350741)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0020, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL WS NSM; 5 ('RTL') (line 350741)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0020, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL WS ON; 5 ('auto') (line 350742)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0020, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL WS ON; 5 ('RTL') (line 350742)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0020, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ON R; 5 ('auto') (line 350743)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0021, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ON R; 5 ('RTL') (line 350743)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0021, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ON AL; 5 ('auto') (line 350744)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0021, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ON AL; 5 ('RTL') (line 350744)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0021, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ON ES; 5 ('auto') (line 350745)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0021, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ON ES; 5 ('RTL') (line 350745)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0021, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ON ET; 5 ('auto') (line 350746)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0021, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ON ET; 5 ('RTL') (line 350746)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0021, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ON CS; 5 ('auto') (line 350747)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0021, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ON CS; 5 ('RTL') (line 350747)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0021, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ON NSM; 5 ('auto') (line 350748)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0021, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ON NSM; 5 ('RTL') (line 350748)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0021, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ON ON; 5 ('auto') (line 350749)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0021, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL ON ON; 5 ('RTL') (line 350749)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x0021, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL PDI R; 5 ('auto') (line 350750)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x2069, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL PDI R; 5 ('RTL') (line 350750)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x2069, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL PDI AL; 5 ('auto') (line 350751)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x2069, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL PDI AL; 5 ('RTL') (line 350751)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x2069, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL PDI ES; 5 ('auto') (line 350752)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x2069, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL PDI ES; 5 ('RTL') (line 350752)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x2069, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL PDI ET; 5 ('auto') (line 350753)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x2069, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL PDI ET; 5 ('RTL') (line 350753)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x2069, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL PDI CS; 5 ('auto') (line 350754)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x2069, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL PDI CS; 5 ('RTL') (line 350754)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x2069, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL PDI NSM; 5 ('auto') (line 350755)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x2069, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL PDI NSM; 5 ('RTL') (line 350755)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x2069, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL PDI ON; 5 ('auto') (line 350756)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x2069, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE AL PDI ON; 5 ('RTL') (line 350756)
        std::vector<uint32_t> const cps = { 0x202B, 0x0608, 0x2069, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES R R; 5 ('auto') (line 350757)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x05BE, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES R R; 5 ('RTL') (line 350757)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x05BE, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES R AL; 5 ('auto') (line 350758)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x05BE, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES R AL; 5 ('RTL') (line 350758)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x05BE, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES R ES; 5 ('auto') (line 350759)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x05BE, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES R ES; 5 ('RTL') (line 350759)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x05BE, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES R ET; 5 ('auto') (line 350760)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x05BE, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES R ET; 5 ('RTL') (line 350760)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x05BE, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_030)
{

    expected_levels = { -1, 3, 3, 3 };

    {
        // RLE ES R CS; 5 ('auto') (line 350761)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x05BE, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES R CS; 5 ('RTL') (line 350761)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x05BE, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES R NSM; 5 ('auto') (line 350762)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x05BE, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES R NSM; 5 ('RTL') (line 350762)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x05BE, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES R ON; 5 ('auto') (line 350763)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x05BE, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES R ON; 5 ('RTL') (line 350763)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x05BE, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES AL R; 5 ('auto') (line 350764)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0608, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES AL R; 5 ('RTL') (line 350764)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0608, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES AL AL; 5 ('auto') (line 350765)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0608, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES AL AL; 5 ('RTL') (line 350765)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0608, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES AL ES; 5 ('auto') (line 350766)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0608, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES AL ES; 5 ('RTL') (line 350766)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0608, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES AL ET; 5 ('auto') (line 350767)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0608, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES AL ET; 5 ('RTL') (line 350767)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0608, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES AL CS; 5 ('auto') (line 350768)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0608, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES AL CS; 5 ('RTL') (line 350768)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0608, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES AL NSM; 5 ('auto') (line 350769)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0608, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES AL NSM; 5 ('RTL') (line 350769)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0608, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES AL ON; 5 ('auto') (line 350770)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0608, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES AL ON; 5 ('RTL') (line 350770)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0608, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ES R; 5 ('auto') (line 350771)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x002B, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ES R; 5 ('RTL') (line 350771)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x002B, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ES AL; 5 ('auto') (line 350772)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x002B, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ES AL; 5 ('RTL') (line 350772)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x002B, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ES ES; 4 ('RTL') (line 350773)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x002B, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ES ET; 4 ('RTL') (line 350774)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x002B, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ES CS; 4 ('RTL') (line 350775)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x002B, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ES NSM; 4 ('RTL') (line 350776)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x002B, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ES ON; 4 ('RTL') (line 350777)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x002B, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ET R; 5 ('auto') (line 350778)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0023, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ET R; 5 ('RTL') (line 350778)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0023, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ET AL; 5 ('auto') (line 350779)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0023, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ET AL; 5 ('RTL') (line 350779)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0023, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ET ES; 4 ('RTL') (line 350780)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0023, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ET ET; 4 ('RTL') (line 350781)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0023, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ET CS; 4 ('RTL') (line 350782)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0023, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ET NSM; 4 ('RTL') (line 350783)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0023, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ET ON; 4 ('RTL') (line 350784)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0023, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES CS R; 5 ('auto') (line 350785)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x002C, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES CS R; 5 ('RTL') (line 350785)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x002C, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_031)
{

    expected_levels = { -1, 3, 3, 3 };

    {
        // RLE ES CS AL; 5 ('auto') (line 350786)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x002C, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES CS AL; 5 ('RTL') (line 350786)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x002C, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES CS ES; 4 ('RTL') (line 350787)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x002C, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES CS ET; 4 ('RTL') (line 350788)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x002C, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES CS CS; 4 ('RTL') (line 350789)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x002C, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES CS NSM; 4 ('RTL') (line 350790)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x002C, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES CS ON; 4 ('RTL') (line 350791)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x002C, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES NSM R; 5 ('auto') (line 350792)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0300, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES NSM R; 5 ('RTL') (line 350792)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0300, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES NSM AL; 5 ('auto') (line 350793)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0300, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES NSM AL; 5 ('RTL') (line 350793)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0300, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES NSM ES; 4 ('RTL') (line 350794)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0300, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES NSM ET; 4 ('RTL') (line 350795)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0300, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES NSM CS; 4 ('RTL') (line 350796)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0300, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES NSM NSM; 4 ('RTL') (line 350797)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0300, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES NSM ON; 4 ('RTL') (line 350798)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0300, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES WS R; 5 ('auto') (line 350799)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0020, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES WS R; 5 ('RTL') (line 350799)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0020, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES WS AL; 5 ('auto') (line 350800)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0020, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES WS AL; 5 ('RTL') (line 350800)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0020, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES WS ES; 4 ('RTL') (line 350801)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0020, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES WS ET; 4 ('RTL') (line 350802)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0020, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES WS CS; 4 ('RTL') (line 350803)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0020, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES WS NSM; 4 ('RTL') (line 350804)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0020, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES WS ON; 4 ('RTL') (line 350805)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0020, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ON R; 5 ('auto') (line 350806)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0021, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ON R; 5 ('RTL') (line 350806)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0021, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ON AL; 5 ('auto') (line 350807)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0021, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ON AL; 5 ('RTL') (line 350807)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0021, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ON ES; 4 ('RTL') (line 350808)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0021, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ON ET; 4 ('RTL') (line 350809)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0021, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ON CS; 4 ('RTL') (line 350810)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0021, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_032)
{

    expected_levels = { -1, 3, 3, 3 };

    {
        // RLE ES ON NSM; 4 ('RTL') (line 350811)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0021, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES ON ON; 4 ('RTL') (line 350812)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x0021, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES PDI R; 5 ('auto') (line 350813)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x2069, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES PDI R; 5 ('RTL') (line 350813)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x2069, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES PDI AL; 5 ('auto') (line 350814)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x2069, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES PDI AL; 5 ('RTL') (line 350814)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x2069, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES PDI ES; 4 ('RTL') (line 350815)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x2069, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES PDI ET; 4 ('RTL') (line 350816)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x2069, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES PDI CS; 4 ('RTL') (line 350817)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x2069, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES PDI NSM; 4 ('RTL') (line 350818)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x2069, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ES PDI ON; 4 ('RTL') (line 350819)
        std::vector<uint32_t> const cps = { 0x202B, 0x002B, 0x2069, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET R R; 5 ('auto') (line 350820)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x05BE, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET R R; 5 ('RTL') (line 350820)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x05BE, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET R AL; 5 ('auto') (line 350821)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x05BE, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET R AL; 5 ('RTL') (line 350821)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x05BE, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET R ES; 5 ('auto') (line 350822)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x05BE, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET R ES; 5 ('RTL') (line 350822)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x05BE, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET R ET; 5 ('auto') (line 350823)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x05BE, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET R ET; 5 ('RTL') (line 350823)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x05BE, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET R CS; 5 ('auto') (line 350824)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x05BE, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET R CS; 5 ('RTL') (line 350824)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x05BE, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET R NSM; 5 ('auto') (line 350825)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x05BE, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET R NSM; 5 ('RTL') (line 350825)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x05BE, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET R ON; 5 ('auto') (line 350826)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x05BE, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET R ON; 5 ('RTL') (line 350826)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x05BE, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET AL R; 5 ('auto') (line 350827)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0608, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET AL R; 5 ('RTL') (line 350827)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0608, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET AL AL; 5 ('auto') (line 350828)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0608, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET AL AL; 5 ('RTL') (line 350828)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0608, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET AL ES; 5 ('auto') (line 350829)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0608, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET AL ES; 5 ('RTL') (line 350829)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0608, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET AL ET; 5 ('auto') (line 350830)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0608, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET AL ET; 5 ('RTL') (line 350830)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0608, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET AL CS; 5 ('auto') (line 350831)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0608, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET AL CS; 5 ('RTL') (line 350831)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0608, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET AL NSM; 5 ('auto') (line 350832)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0608, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET AL NSM; 5 ('RTL') (line 350832)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0608, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET AL ON; 5 ('auto') (line 350833)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0608, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET AL ON; 5 ('RTL') (line 350833)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0608, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ES R; 5 ('auto') (line 350834)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x002B, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ES R; 5 ('RTL') (line 350834)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x002B, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ES AL; 5 ('auto') (line 350835)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x002B, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ES AL; 5 ('RTL') (line 350835)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x002B, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_033)
{

    expected_levels = { -1, 3, 3, 3 };

    {
        // RLE ET ES ES; 4 ('RTL') (line 350836)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x002B, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ES ET; 4 ('RTL') (line 350837)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x002B, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ES CS; 4 ('RTL') (line 350838)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x002B, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ES NSM; 4 ('RTL') (line 350839)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x002B, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ES ON; 4 ('RTL') (line 350840)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x002B, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ET R; 5 ('auto') (line 350841)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0023, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ET R; 5 ('RTL') (line 350841)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0023, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ET AL; 5 ('auto') (line 350842)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0023, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ET AL; 5 ('RTL') (line 350842)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0023, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ET ES; 4 ('RTL') (line 350843)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0023, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ET ET; 4 ('RTL') (line 350844)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0023, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ET CS; 4 ('RTL') (line 350845)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0023, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ET NSM; 4 ('RTL') (line 350846)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0023, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ET ON; 4 ('RTL') (line 350847)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0023, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET CS R; 5 ('auto') (line 350848)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x002C, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET CS R; 5 ('RTL') (line 350848)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x002C, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET CS AL; 5 ('auto') (line 350849)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x002C, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET CS AL; 5 ('RTL') (line 350849)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x002C, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET CS ES; 4 ('RTL') (line 350850)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x002C, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET CS ET; 4 ('RTL') (line 350851)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x002C, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET CS CS; 4 ('RTL') (line 350852)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x002C, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET CS NSM; 4 ('RTL') (line 350853)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x002C, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET CS ON; 4 ('RTL') (line 350854)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x002C, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET NSM R; 5 ('auto') (line 350855)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0300, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET NSM R; 5 ('RTL') (line 350855)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0300, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET NSM AL; 5 ('auto') (line 350856)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0300, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET NSM AL; 5 ('RTL') (line 350856)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0300, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET NSM ES; 4 ('RTL') (line 350857)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0300, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET NSM ET; 4 ('RTL') (line 350858)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0300, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET NSM CS; 4 ('RTL') (line 350859)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0300, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET NSM NSM; 4 ('RTL') (line 350860)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0300, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_034)
{

    expected_levels = { -1, 3, 3, 3 };

    {
        // RLE ET NSM ON; 4 ('RTL') (line 350861)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0300, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET WS R; 5 ('auto') (line 350862)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0020, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET WS R; 5 ('RTL') (line 350862)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0020, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET WS AL; 5 ('auto') (line 350863)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0020, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET WS AL; 5 ('RTL') (line 350863)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0020, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET WS ES; 4 ('RTL') (line 350864)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0020, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET WS ET; 4 ('RTL') (line 350865)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0020, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET WS CS; 4 ('RTL') (line 350866)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0020, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET WS NSM; 4 ('RTL') (line 350867)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0020, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET WS ON; 4 ('RTL') (line 350868)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0020, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ON R; 5 ('auto') (line 350869)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0021, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ON R; 5 ('RTL') (line 350869)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0021, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ON AL; 5 ('auto') (line 350870)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0021, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ON AL; 5 ('RTL') (line 350870)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0021, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ON ES; 4 ('RTL') (line 350871)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0021, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ON ET; 4 ('RTL') (line 350872)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0021, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ON CS; 4 ('RTL') (line 350873)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0021, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ON NSM; 4 ('RTL') (line 350874)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0021, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET ON ON; 4 ('RTL') (line 350875)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x0021, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET PDI R; 5 ('auto') (line 350876)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x2069, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET PDI R; 5 ('RTL') (line 350876)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x2069, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET PDI AL; 5 ('auto') (line 350877)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x2069, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET PDI AL; 5 ('RTL') (line 350877)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x2069, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET PDI ES; 4 ('RTL') (line 350878)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x2069, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET PDI ET; 4 ('RTL') (line 350879)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x2069, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET PDI CS; 4 ('RTL') (line 350880)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x2069, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET PDI NSM; 4 ('RTL') (line 350881)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x2069, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE ET PDI ON; 4 ('RTL') (line 350882)
        std::vector<uint32_t> const cps = { 0x202B, 0x0023, 0x2069, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS R R; 5 ('auto') (line 350883)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x05BE, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS R R; 5 ('RTL') (line 350883)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x05BE, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS R AL; 5 ('auto') (line 350884)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x05BE, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS R AL; 5 ('RTL') (line 350884)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x05BE, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS R ES; 5 ('auto') (line 350885)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x05BE, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS R ES; 5 ('RTL') (line 350885)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x05BE, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_035)
{

    expected_levels = { -1, 3, 3, 3 };

    {
        // RLE CS R ET; 5 ('auto') (line 350886)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x05BE, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS R ET; 5 ('RTL') (line 350886)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x05BE, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS R CS; 5 ('auto') (line 350887)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x05BE, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS R CS; 5 ('RTL') (line 350887)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x05BE, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS R NSM; 5 ('auto') (line 350888)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x05BE, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS R NSM; 5 ('RTL') (line 350888)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x05BE, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS R ON; 5 ('auto') (line 350889)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x05BE, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS R ON; 5 ('RTL') (line 350889)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x05BE, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS AL R; 5 ('auto') (line 350890)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0608, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS AL R; 5 ('RTL') (line 350890)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0608, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS AL AL; 5 ('auto') (line 350891)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0608, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS AL AL; 5 ('RTL') (line 350891)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0608, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS AL ES; 5 ('auto') (line 350892)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0608, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS AL ES; 5 ('RTL') (line 350892)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0608, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS AL ET; 5 ('auto') (line 350893)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0608, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS AL ET; 5 ('RTL') (line 350893)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0608, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS AL CS; 5 ('auto') (line 350894)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0608, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS AL CS; 5 ('RTL') (line 350894)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0608, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS AL NSM; 5 ('auto') (line 350895)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0608, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS AL NSM; 5 ('RTL') (line 350895)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0608, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS AL ON; 5 ('auto') (line 350896)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0608, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS AL ON; 5 ('RTL') (line 350896)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0608, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ES R; 5 ('auto') (line 350897)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x002B, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ES R; 5 ('RTL') (line 350897)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x002B, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ES AL; 5 ('auto') (line 350898)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x002B, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ES AL; 5 ('RTL') (line 350898)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x002B, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ES ES; 4 ('RTL') (line 350899)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x002B, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ES ET; 4 ('RTL') (line 350900)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x002B, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ES CS; 4 ('RTL') (line 350901)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x002B, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ES NSM; 4 ('RTL') (line 350902)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x002B, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ES ON; 4 ('RTL') (line 350903)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x002B, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ET R; 5 ('auto') (line 350904)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0023, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ET R; 5 ('RTL') (line 350904)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0023, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ET AL; 5 ('auto') (line 350905)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0023, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ET AL; 5 ('RTL') (line 350905)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0023, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ET ES; 4 ('RTL') (line 350906)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0023, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ET ET; 4 ('RTL') (line 350907)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0023, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ET CS; 4 ('RTL') (line 350908)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0023, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ET NSM; 4 ('RTL') (line 350909)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0023, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ET ON; 4 ('RTL') (line 350910)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0023, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_036)
{

    expected_levels = { -1, 3, 3, 3 };

    {
        // RLE CS CS R; 5 ('auto') (line 350911)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x002C, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS CS R; 5 ('RTL') (line 350911)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x002C, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS CS AL; 5 ('auto') (line 350912)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x002C, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS CS AL; 5 ('RTL') (line 350912)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x002C, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS CS ES; 4 ('RTL') (line 350913)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x002C, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS CS ET; 4 ('RTL') (line 350914)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x002C, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS CS CS; 4 ('RTL') (line 350915)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x002C, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS CS NSM; 4 ('RTL') (line 350916)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x002C, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS CS ON; 4 ('RTL') (line 350917)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x002C, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS NSM R; 5 ('auto') (line 350918)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0300, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS NSM R; 5 ('RTL') (line 350918)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0300, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS NSM AL; 5 ('auto') (line 350919)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0300, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS NSM AL; 5 ('RTL') (line 350919)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0300, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS NSM ES; 4 ('RTL') (line 350920)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0300, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS NSM ET; 4 ('RTL') (line 350921)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0300, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS NSM CS; 4 ('RTL') (line 350922)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0300, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS NSM NSM; 4 ('RTL') (line 350923)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0300, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS NSM ON; 4 ('RTL') (line 350924)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0300, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS WS R; 5 ('auto') (line 350925)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0020, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS WS R; 5 ('RTL') (line 350925)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0020, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS WS AL; 5 ('auto') (line 350926)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0020, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS WS AL; 5 ('RTL') (line 350926)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0020, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS WS ES; 4 ('RTL') (line 350927)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0020, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS WS ET; 4 ('RTL') (line 350928)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0020, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS WS CS; 4 ('RTL') (line 350929)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0020, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS WS NSM; 4 ('RTL') (line 350930)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0020, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS WS ON; 4 ('RTL') (line 350931)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0020, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ON R; 5 ('auto') (line 350932)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0021, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ON R; 5 ('RTL') (line 350932)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0021, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ON AL; 5 ('auto') (line 350933)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0021, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ON AL; 5 ('RTL') (line 350933)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0021, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ON ES; 4 ('RTL') (line 350934)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0021, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ON ET; 4 ('RTL') (line 350935)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0021, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_037)
{

    expected_levels = { -1, 3, 3, 3 };

    {
        // RLE CS ON CS; 4 ('RTL') (line 350936)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0021, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ON NSM; 4 ('RTL') (line 350937)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0021, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS ON ON; 4 ('RTL') (line 350938)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x0021, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS PDI R; 5 ('auto') (line 350939)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x2069, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS PDI R; 5 ('RTL') (line 350939)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x2069, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS PDI AL; 5 ('auto') (line 350940)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x2069, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS PDI AL; 5 ('RTL') (line 350940)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x2069, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS PDI ES; 4 ('RTL') (line 350941)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x2069, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS PDI ET; 4 ('RTL') (line 350942)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x2069, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS PDI CS; 4 ('RTL') (line 350943)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x2069, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS PDI NSM; 4 ('RTL') (line 350944)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x2069, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE CS PDI ON; 4 ('RTL') (line 350945)
        std::vector<uint32_t> const cps = { 0x202B, 0x002C, 0x2069, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM R R; 5 ('auto') (line 350946)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x05BE, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM R R; 5 ('RTL') (line 350946)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x05BE, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM R AL; 5 ('auto') (line 350947)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x05BE, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM R AL; 5 ('RTL') (line 350947)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x05BE, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM R ES; 5 ('auto') (line 350948)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x05BE, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM R ES; 5 ('RTL') (line 350948)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x05BE, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM R ET; 5 ('auto') (line 350949)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x05BE, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM R ET; 5 ('RTL') (line 350949)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x05BE, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM R CS; 5 ('auto') (line 350950)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x05BE, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM R CS; 5 ('RTL') (line 350950)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x05BE, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM R NSM; 5 ('auto') (line 350951)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x05BE, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM R NSM; 5 ('RTL') (line 350951)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x05BE, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM R ON; 5 ('auto') (line 350952)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x05BE, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM R ON; 5 ('RTL') (line 350952)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x05BE, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM AL R; 5 ('auto') (line 350953)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0608, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM AL R; 5 ('RTL') (line 350953)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0608, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM AL AL; 5 ('auto') (line 350954)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0608, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM AL AL; 5 ('RTL') (line 350954)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0608, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM AL ES; 5 ('auto') (line 350955)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0608, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM AL ES; 5 ('RTL') (line 350955)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0608, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM AL ET; 5 ('auto') (line 350956)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0608, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM AL ET; 5 ('RTL') (line 350956)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0608, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM AL CS; 5 ('auto') (line 350957)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0608, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM AL CS; 5 ('RTL') (line 350957)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0608, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM AL NSM; 5 ('auto') (line 350958)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0608, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM AL NSM; 5 ('RTL') (line 350958)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0608, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM AL ON; 5 ('auto') (line 350959)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0608, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM AL ON; 5 ('RTL') (line 350959)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0608, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ES R; 5 ('auto') (line 350960)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x002B, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ES R; 5 ('RTL') (line 350960)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x002B, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_038)
{

    expected_levels = { -1, 3, 3, 3 };

    {
        // RLE NSM ES AL; 5 ('auto') (line 350961)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x002B, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ES AL; 5 ('RTL') (line 350961)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x002B, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ES ES; 4 ('RTL') (line 350962)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x002B, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ES ET; 4 ('RTL') (line 350963)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x002B, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ES CS; 4 ('RTL') (line 350964)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x002B, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ES NSM; 4 ('RTL') (line 350965)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x002B, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ES ON; 4 ('RTL') (line 350966)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x002B, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ET R; 5 ('auto') (line 350967)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0023, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ET R; 5 ('RTL') (line 350967)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0023, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ET AL; 5 ('auto') (line 350968)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0023, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ET AL; 5 ('RTL') (line 350968)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0023, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ET ES; 4 ('RTL') (line 350969)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0023, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ET ET; 4 ('RTL') (line 350970)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0023, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ET CS; 4 ('RTL') (line 350971)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0023, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ET NSM; 4 ('RTL') (line 350972)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0023, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ET ON; 4 ('RTL') (line 350973)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0023, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM CS R; 5 ('auto') (line 350974)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x002C, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM CS R; 5 ('RTL') (line 350974)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x002C, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM CS AL; 5 ('auto') (line 350975)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x002C, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM CS AL; 5 ('RTL') (line 350975)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x002C, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM CS ES; 4 ('RTL') (line 350976)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x002C, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM CS ET; 4 ('RTL') (line 350977)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x002C, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM CS CS; 4 ('RTL') (line 350978)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x002C, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM CS NSM; 4 ('RTL') (line 350979)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x002C, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM CS ON; 4 ('RTL') (line 350980)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x002C, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM NSM R; 5 ('auto') (line 350981)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0300, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM NSM R; 5 ('RTL') (line 350981)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0300, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM NSM AL; 5 ('auto') (line 350982)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0300, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM NSM AL; 5 ('RTL') (line 350982)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0300, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM NSM ES; 4 ('RTL') (line 350983)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0300, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM NSM ET; 4 ('RTL') (line 350984)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0300, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM NSM CS; 4 ('RTL') (line 350985)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0300, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }
}

TEST(bidi, bidi_350_039)
{

    expected_levels = { -1, 3, 3, 3 };

    {
        // RLE NSM NSM NSM; 4 ('RTL') (line 350986)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0300, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM NSM ON; 4 ('RTL') (line 350987)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0300, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM WS R; 5 ('auto') (line 350988)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0020, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM WS R; 5 ('RTL') (line 350988)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0020, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM WS AL; 5 ('auto') (line 350989)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0020, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM WS AL; 5 ('RTL') (line 350989)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0020, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM WS ES; 4 ('RTL') (line 350990)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0020, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM WS ET; 4 ('RTL') (line 350991)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0020, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM WS CS; 4 ('RTL') (line 350992)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0020, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM WS NSM; 4 ('RTL') (line 350993)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0020, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM WS ON; 4 ('RTL') (line 350994)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0020, 0x0021 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ON R; 5 ('auto') (line 350995)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0021, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ON R; 5 ('RTL') (line 350995)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0021, 0x05BE };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ON AL; 5 ('auto') (line 350996)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0021, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), -1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ON AL; 5 ('RTL') (line 350996)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0021, 0x0608 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ON ES; 4 ('RTL') (line 350997)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0021, 0x002B };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ON ET; 4 ('RTL') (line 350998)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0021, 0x0023 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ON CS; 4 ('RTL') (line 350999)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0021, 0x002C };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

    {
        // RLE NSM ON NSM; 4 ('RTL') (line 351000)
        std::vector<uint32_t> const cps = { 0x202B, 0x0300, 0x0021, 0x0300 };
        std::vector<int> const levels =
            bidi_levels(&*cps.begin(), &*cps.end(), 1);
        int i = 0;
        for (int l : expected_levels) {
            if (0 <= l) {
                EXPECT_EQ(levels[i], l) << "i=" << i;
                ++i;
            }
        }
        EXPECT_EQ((int)levels.size(), i);
    }

}
